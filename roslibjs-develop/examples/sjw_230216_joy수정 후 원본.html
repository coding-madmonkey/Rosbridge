<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script src="../build/roslib.js"></script>
<script>
    // Connecting to my ROS
    // -----------------


    var controller_ros = new ROSLIB.Ros();

    // If there is an error on the backend, an 'error' emit will be emitted.
    controller_ros.on('error', function(error) {
      document.getElementById('status').innerHTML = 'Error';
      console.log(error);
    });

    // Find out exactly when we made a connection.
    controller_ros.on('connection', function() {
      console.log('Connection made!');
      document.getElementById('status').innerHTML = 'Connected';
    });

    controller_ros.on('close', function() {
      console.log('Connection closed.');
      document.getElementById('status').innerHTML = 'Closed';
    });

    // Create a connection to the rosbridge WebSocket server.
    //controller_ros.connect('ws://localhost:9090');  //!fix
     controller_ros.connect('ws://localhost:50001');  //수정
/////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////

      // Connecting to robot(remote) ROS
    // -----------------
    var robot_ros = new ROSLIB.Ros();

    // If there is an error on the backend, an 'error' emit will be emitted.
    robot_ros.on('error', function(error) {
      document.getElementById('robot_status').innerHTML = 'Error';
      //document.getElementById('error').style.display = 'inline';
      console.log(error);
    });

    // Find out exactly when we made a connection.
    robot_ros.on('connection', function() {
      console.log('Connection made!');
      document.getElementById('robot_status').innerHTML = 'Connected';
      //document.getElementById('connected').style.display = 'inline';
    });

    robot_ros.on('close', function() {
      console.log('Connection closed.');
      document.getElementById('robot_status').innerHTML = 'Closed';
      //document.getElementById('closed').style.display = 'inline';
    });
    
    //robot_ros.connect('ws://192.168.50.11:50001');  //!fix
    //robot_ros.connect('ws://192.168.50.182:9090');  //수정 공유기 내부ip
     robot_ros.connect('ws://223.171.62.1:9090');  //수정 공유기 고정ip
    ////////////////////////////////////////////////
    var JoyListener = new ROSLIB.Topic({
          ros : controller_ros,
          name : '/joy',
          messageType : 'sensor_msgs/Joy'
    });
    var robot_joypub = new ROSLIB.Topic({
          ros : robot_ros,
          name : '/joyFromController',
          messageType : 'sensor_msgs/Joy'
    });    
    ////////////////////////////////////////////////
    //!add
    // 수정
    var intListener = new ROSLIB.Topic({
          ros : controller_ros,
          name : '/sendint',
          messageType : 'std_msgs/Int16'
    });
    var robot_intpub = new ROSLIB.Topic({
          ros : robot_ros,
          name : '/intFromController',
          messageType : 'std_msgs/Int16'
    });
    ////////////////////////////////////////////////
//인터넷에서 디버그하기 위한것, 디버그할때 숫자가 쌓이는것은 같은것이 쌓이는것이고 새로운것은 아래로 내려감
   JoyListener.subscribe(function(message) {    
     console.log('joy hit!')
         robot_joypub.publish(message);
         delete message
   });
    ////////////////////////////////////////////////
    //!add 

   intListener.subscribe(function(message) {    
     console.log('int hit!')
         robot_intpub.publish(message);
         delete message
   });







    ////////////////////////////////////////////////
  

</script>
</head>

<body>
  <h1> SJW GCS Control </h1>

                        
  <div id="statusIndicator">
    <p>
        Controller & Robot Connection status: ( <span id="status"></span> / <span id="robot_status"></span> )
    </p>

    <!--p>
      RobotPC - Joybuttons0 : <span id="robot_buttons0"></span>
    </p-->
  </div>


  <script>
    window.onload = function(){
      timer = setInterval(function(){
        // timer_talker();
        //robot_joyfunction();
      }, 50); // -> ms
    };


  </script>
</body>
</html>
